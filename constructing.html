<html><head><title>lightQL: Constructing lightQL queries</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Tecsisa" /><meta name="description" content="A minimal external search DSL that compiles to Scala" /><meta name="og:image" content="/lightQL/img/poster.png" /><meta name="og:title" content="lightQL: Constructing lightQL queries" /><meta name="og:site_name" content="lightQL" /><meta name="og:url" content="http://www.tecsisa.com" /><meta name="og:type" content="website" /><meta name="og:description" content="A minimal external search DSL that compiles to Scala" /><link rel="icon" type="image/png" href="/lightQL/img/favicon.png" /><meta name="twitter:title" content="lightQL: Constructing lightQL queries" /><meta name="twitter:image" content="http://www.tecsisa.comimg/poster.png" /><meta name="twitter:description" content="A minimal external search DSL that compiles to Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/lightQL/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/lightQL/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/lightQL/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/lightQL/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/lightQL/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/lightQL/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/lightQL/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/lightQL/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/lightQL/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/lightQL/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/lightQL/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/lightQL/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/lightQL/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/lightQL/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/lightQL/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/lightQL/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/lightQL/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/lightQL/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/lightQL/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/lightQL/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/lightQL/highlight/styles/default.css" /><link rel="stylesheet" href="/lightQL/css/style.css" /><link rel="stylesheet" href="/lightQL/css/palette.css" /><link rel="stylesheet" href="/lightQL/css/codemirror.css" /><link rel="stylesheet" href="/lightQL/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/lightQL/" class="brand"><div class="brand-wrapper"><span>lightQL</span></div></a></li> <li><a href="/lightQL/constructing.html" class="">Constructing queries</a></li> <li><a href="/lightQL/term_types.html" class="">Term types</a></li> <li><a href="/lightQL/supported.html" class="">Supported queries</a></li> <li><a href="/lightQL/contributing.html" class="">Contributing</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/Tecsisa/lightQL"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/Tecsisa/lightQL"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('lightQL A minimal external search DSL that compiles to Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('lightQL A minimal external search DSL that compiles to Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="Tecsisa" data-github-repo="lightQL"><div class="content-wrapper"><section><h1 id="constructing-queries">Constructing queries</h1>

<p>Generally speaking, you can apply some intuition about how a query should be
based on your knowledge of SQL and other similar languages. The only important difference
is that derived from the fact that, in search engines, it is always possible to search either
for the exact term or, otherwise, perform an approximate search, also known as a <em>full-text search</em>. In terms of lightQL,
the first is called a <em>filtered query</em>  while the latter is called a <em>match query</em>.</p>

<h2 id="filtered-queries">Filtered queries</h2>

<p><em>Filtered queries</em> are composed by terms that use the <code class="highlighter-rouge">=</code> (pronounced <em>equals</em>) or
the <code class="highlighter-rouge">!=</code> (pronounced <em>not equals</em>) operator. These kind of queries perform searches
that filter by exact terms.</p>

<p>Please, see below some examples of these queries:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.tecsisa.lightql.parser._</span>
<span class="k">import</span> <span class="nn">com.tecsisa.lightql.parser._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">parse</span><span class="o">(</span><span class="s">"composer = \"Johann Sebastian Bach\""</span><span class="o">)</span> <span class="c1">// songs composed by `Johann Sebastian Bach`
</span><span class="n">res0</span><span class="k">:</span> <span class="kt">com.tecsisa.lightql.parser.StringParsed</span><span class="o">[</span><span class="kt">com.tecsisa.lightql.ast.Query</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Query</span><span class="o">(</span><span class="nc">Clause</span><span class="o">(</span><span class="n">composer</span><span class="o">,=,</span><span class="nc">Johann</span> <span class="nc">Sebastian</span> <span class="nc">Bach</span><span class="o">)),</span><span class="mi">34</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">parse</span><span class="o">(</span><span class="s">"genre != \"Classical\""</span><span class="o">)</span> <span class="c1">// songs that its genre is `Classical`
</span><span class="n">res1</span><span class="k">:</span> <span class="kt">com.tecsisa.lightql.parser.StringParsed</span><span class="o">[</span><span class="kt">com.tecsisa.lightql.ast.Query</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Query</span><span class="o">(</span><span class="nc">Clause</span><span class="o">(</span><span class="n">genre</span><span class="o">,!=,</span><span class="nc">Classical</span><span class="o">)),</span><span class="mi">20</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">parse</span><span class="o">(</span><span class="s">"stats-&gt;rate.stars = 5.0"</span><span class="o">)</span> <span class="c1">// songs starred with 5.0
</span><span class="n">res2</span><span class="k">:</span> <span class="kt">com.tecsisa.lightql.parser.StringParsed</span><span class="o">[</span><span class="kt">com.tecsisa.lightql.ast.Query</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Query</span><span class="o">(</span><span class="nc">Clause</span><span class="o">(</span><span class="n">stats</span><span class="o">-&gt;</span><span class="n">rate</span><span class="o">.</span><span class="n">stars</span><span class="o">,=,</span><span class="mf">5.0</span><span class="o">)),</span><span class="mi">23</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">parse</span><span class="o">(</span><span class="s">"composer = \"Johann Sebastian Bach\" and price &gt; 0.99"</span><span class="o">)</span> <span class="c1">// songs by `Johann Sebastian Bach` that its price is greater than 0.99
</span><span class="n">res3</span><span class="k">:</span> <span class="kt">com.tecsisa.lightql.parser.StringParsed</span><span class="o">[</span><span class="kt">com.tecsisa.lightql.ast.Query</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Query</span><span class="o">(</span><span class="nc">CombinedClause</span><span class="o">(</span><span class="nc">Clause</span><span class="o">(</span><span class="n">composer</span><span class="o">,=,</span><span class="nc">Johann</span> <span class="nc">Sebastian</span> <span class="nc">Bach</span><span class="o">),</span><span class="n">and</span><span class="o">,</span><span class="nc">Clause</span><span class="o">(</span><span class="n">price</span><span class="o">,&gt;,</span><span class="mf">0.99</span><span class="o">))),</span><span class="mi">51</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="match-queries">Match queries</h2>

<p><em>Match queries</em> are composed by terms that use the <code class="highlighter-rouge">~</code> (pronounced <em>matches</em>) or
the <code class="highlighter-rouge">!~</code> (pronounced <em>not matches</em>) operator. These kind of queries perform
<em>full-text</em> searches that look for aproximate terms.</p>

<p>Please, see below some examples of this kind of queries:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.tecsisa.lightql.parser._</span>
<span class="k">import</span> <span class="nn">com.tecsisa.lightql.parser._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">parse</span><span class="o">(</span><span class="s">"name ~ \"paranoid\""</span><span class="o">)</span> <span class="c1">// songs that their name matches the word `paranoid` (maybe Radiohead's `Paranoid Android`?)
</span><span class="n">res4</span><span class="k">:</span> <span class="kt">com.tecsisa.lightql.parser.StringParsed</span><span class="o">[</span><span class="kt">com.tecsisa.lightql.ast.Query</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Query</span><span class="o">(</span><span class="nc">Clause</span><span class="o">(</span><span class="n">name</span><span class="o">,~,</span><span class="n">paranoid</span><span class="o">)),</span><span class="mi">17</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">parse</span><span class="o">(</span><span class="s">"artist !~ \"lips\""</span><span class="o">)</span> <span class="c1">// songs that their artist not matches the word `lips` (maybe not `Flaming Lips` songs?)
</span><span class="n">res5</span><span class="k">:</span> <span class="kt">com.tecsisa.lightql.parser.StringParsed</span><span class="o">[</span><span class="kt">com.tecsisa.lightql.ast.Query</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Query</span><span class="o">(</span><span class="nc">Clause</span><span class="o">(</span><span class="n">artist</span><span class="o">,!~,</span><span class="n">lips</span><span class="o">)),</span><span class="mi">16</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">parse</span><span class="o">(</span><span class="s">"name ~ \"paranoid\" and artist !~ \"radiohead\""</span><span class="o">)</span> <span class="c1">// any paranoid song that is not from Radiohead? (I doubt it ;-))
</span><span class="n">res6</span><span class="k">:</span> <span class="kt">com.tecsisa.lightql.parser.StringParsed</span><span class="o">[</span><span class="kt">com.tecsisa.lightql.ast.Query</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Query</span><span class="o">(</span><span class="nc">CombinedClause</span><span class="o">(</span><span class="nc">Clause</span><span class="o">(</span><span class="n">name</span><span class="o">,~,</span><span class="n">paranoid</span><span class="o">),</span><span class="n">and</span><span class="o">,</span><span class="nc">Clause</span><span class="o">(</span><span class="n">artist</span><span class="o">,!~,</span><span class="n">radiohead</span><span class="o">))),</span><span class="mi">43</span><span class="o">)</span>
</code></pre>
</div>

<p>Take into account that match query terms only make sense on text fields, but
as we’ll see in a moment, it’s always possible to define a mixed query with
both match and filter terms.</p>

<h2 id="mixed-queries">Mixed queries</h2>

<p>Both exact search terms and approximate ones can take part of the same query,
being called in this case <em>mixed queries</em>. For example:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.tecsisa.lightql.parser._</span>
<span class="k">import</span> <span class="nn">com.tecsisa.lightql.parser._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">parse</span><span class="o">(</span><span class="s">"name ~ \"paranoid\" and price &lt;= 0.99"</span><span class="o">)</span> <span class="c1">// paranoid songs that their price is less than or equal to 0.99)
</span><span class="n">res7</span><span class="k">:</span> <span class="kt">com.tecsisa.lightql.parser.StringParsed</span><span class="o">[</span><span class="kt">com.tecsisa.lightql.ast.Query</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Query</span><span class="o">(</span><span class="nc">CombinedClause</span><span class="o">(</span><span class="nc">Clause</span><span class="o">(</span><span class="n">name</span><span class="o">,~,</span><span class="n">paranoid</span><span class="o">),</span><span class="n">and</span><span class="o">,</span><span class="nc">Clause</span><span class="o">(</span><span class="n">price</span><span class="o">,&lt;=,</span><span class="mf">0.99</span><span class="o">))),</span><span class="mi">35</span><span class="o">)</span>
</code></pre>
</div>

<h3 id="a-cautionary-tale">A cautionary tale</h3>

<p>It is important to note that, depending on the way the search engine deals with
<em>full-text</em> search, the query results might be confusing sometimes. For example, a
<em>filtered query</em> on an Elasticsearch analyzed document field, might not return any results
even if the query string is exactly equals to the indexed value. This apparent mistake
is only understood after being aware of the analytical process carried out during the indexing job.</p>

<p>As an example, let’s say that we index a document with some field <code class="highlighter-rouge">name</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>name -&gt; 'The Dark Side of the Moon'
</code></pre>
</div>

<p>If this <code class="highlighter-rouge">name</code> field is a document analyzed field, the indexing process will
include an analysis step that, depending on the analyzer, will decompose the
value in its basic and significant tokens, e.g.:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dark
side
moon
</code></pre>
</div>

<p>That’s the reason why, the exact term <code class="highlighter-rouge">The Dark Side of the Moon</code> won’t work
in this particular case. For those queries that need to response to exact terms
correctly, be sure that the involved fields are not analyzed.</p>

<p>Please, see <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html">this</a> for details about the analysis process
on Elasticsearch.</p>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/lightQL/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/lightQL/js/main.js"></script></body></html>